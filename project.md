# 게임 대사 OCR 추출기 - 프로젝트 스펙

## 1. 프로젝트 개요

게임 스크립트를 녹화한 비디오 파일(MP4)에서 말풍선 내의 대사들을 OCR로 인식하여, Electron 앱 UI를 통해 편집/확인 후 JSON으로 저장하는 도구.
최종 용도는 게임 스크립트 아카이빙/기록용.

---

## 2. 대상 게임 특성

### 말풍선 구조
- **위치**: 고정 위치에 표시되나, 대사 길이에 따라 새 말풍선이 생기거나 아래로 길어질 수 있음
- **화자명 위치**: 말풍선이 향하는 쪽(좌/우) 하단에 표시
- **동시 표시**: 한 번에 하나의 말풍선만 표시됨 (동시 대화 없음)
- **텍스트 표시**: 즉시 전체 표시 (타이핑 애니메이션 없음)
- **나레이션/독백**: 말풍선과 별도 형식으로 존재하나, 1차 개발에서는 제외 (추후 추가)

### 텍스트 언어
- **한국어 단일** (다국어 혼합 없음)

### 화자명 예외
- 화자명이 없는 경우(나레이션/독백)는 별도 형식으로 존재 → 추후 지원

---

## 3. 녹화 환경

- **녹화 방식**: 모바일(스마트폰/태블릿) 화면 녹화
- **해상도**: 720p ~ 1080p
- **파일 포맷**: MP4만 지원
- **영상 길이**: 5~30분 (대사 30~150개 수준)

---

## 4. OCR 엔진

### 현재 구현 (ocr.py)
- **Tesseract + EasyOCR** 이중 구조
  - 긴 문장: Tesseract가 인식률이 우수하여 우선 사용
  - 짧은 문장: Tesseract 인식 실패 시 EasyOCR로 재인식
- **인식 정확도**: 현재 수준으로 충분
- **대사 전환 감지**: ocr.py에 이미 구현되어 있음 (기존 로직 그대로 사용)
- **말풍선 영역 감지**: 고정 영역 마스크 기반으로 처리 (현재 방식 유지)
- **중복 제거**: 텍스트 완전 일치 기준으로 동일 대사 합침

### 대상 게임 확장
- 현재는 단일 게임 대상, 추후 여러 게임으로 확장 가능하도록 고려

---

## 5. Electron 앱 아키텍처

### 프론트엔드
- **프레임워크**: Vue.js
- **테마**: 라이트 모드
- **레이아웃**: 단일 칼럼

### Electron ↔ Python 통신
- 안정적이고 진행률 전달이 가능한 방식이면 무관
- **권장**: HTTP API 서버 (FastAPI 등) — 진행률 실시간 전달에 유리
  - 또는 child_process + stdout 스트리밍

---

## 6. UI/UX 상세

### 메인 화면 흐름
1. **영상 불러오기**: MP4 파일 선택
2. **OCR 처리**: 프로그레스바로 진행률 표시 (취소 기능 불필요)
3. **결과 편집**: 대사 리스트 표시 및 편집
4. **저장**: JSON으로 저장

### 대사 리스트 (단일 칼럼)
- 각 항목에 표시되는 정보: **화자명 + 대사 텍스트**
- 화자명: 자유 텍스트 입력으로 수정 가능
- 대사: 자유 텍스트 입력으로 수정 가능
- 대사 클릭 시: 해당 프레임의 **말풍선 영역 크롭 이미지**를 팝업으로 표시

### 인식 실패 처리
- 빈 문자열이나 깨진 문자도 그대로 표시 (사용자가 직접 수정)
- 별도 경고/필터링 없음

### 스크린샷 연동
- OCR 처리 시 각 대사에 해당하는 프레임에서 **말풍선 영역만 크롭**하여 임시 저장
- 편집 중 대사 클릭 시 크롭 이미지를 팝업으로 표시하여 원본 확인 가능
- **최종 JSON 저장 시 임시 크롭 이미지 삭제**

### 저장 기능
- **자동 저장**: 영상 파일명 기반으로 자동 저장 경로/파일명 설정
- **다른 이름으로 저장**: 표준 파일 저장 대화상자로 경로/파일명 직접 지정 가능
- 두 가지 모두 제공

### 세션 관리
- 세션 유지/복원 불필요 — 한 번의 세션 내에서만 작업

---

## 7. JSON 출력 포맷

### 구조 (최소한)
```json
{
  "source": "영상파일명 ",
  "dialogues": [
    {
      "speaker": "화자명",
      "text": "대사 내용"
    },
    {
      "speaker": "화자명",
      "text": "대사 내용"
    }
  ]
}
```

- 메타데이터는 최소한으로 유지 (타임스탬프, 신뢰도 점수 등 불포함)
- `speaker`가 빈 문자열일 수 있음 (인식 실패 시)

---

## 8. 기술 스택 요약

| 구분 | 기술 |
|------|------|
| UI 프레임워크 | Electron + Vue.js |
| OCR 엔진 | Tesseract + EasyOCR (Python) |
| OCR 로직 | ocr.py (기존 구현 활용) |
| 영상 처리 | OpenCV (Python) |
| 통신 방식 | 미정 (HTTP API 또는 child_process) |
| 파일 포맷 | 입력: MP4, 출력: JSON |
| 디자인 | 라이트 모드, 단일 칼럼 |
| 배포 | 미정 (개발 환경에서 우선 동작) |

---

## 9. 스코프 정리

### 1차 개발 범위 (MVP)
- MP4 영상 불러오기
- OCR 처리 (기존 ocr.py 활용) + 프로그레스바
- 대사 리스트 표시 (화자명 + 대사)
- 화자명/대사 텍스트 수정
- 대사 클릭 시 말풍선 크롭 이미지 팝업
- JSON 저장 (자동 + 다른 이름으로 저장)
- 단건 처리 (한 번에 영상 하나)

### 추후 확장 예정
- 나레이션/독백 인식 지원
- 다수 게임 대응 (게임별 마스크/설정 프로파일)
- 배포 패키징
